<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12A2 TOOLS - Mã Hóa Nội Dung & Nhúng Media</title>
    <!-- Thư viện chuyển đổi Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Thư viện mã hóa/giải mã -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Font Icon -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* === ROOT VARIABLES === */
        :root {
            --primary: #00f7ff; --secondary: #6e00ff; --accent: #ff00aa;
            --error: #ff3d71; --success: #00ff88; --warning: #ffcc00;
            --bg-dark: #0a0a20; --bg-darker: #050510; --bg-light: rgba(20, 20, 50, 0.5);
            --bg-lighter: rgba(30, 30, 70, 0.3); --text-light: #e0e0ff;
            --text-lighter: #ffffff; --text-dim: rgba(224, 224, 255, 0.6);
            --border-radius: 12px; --box-shadow: 0 0 30px rgba(0, 247, 255, 0.2);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --media-border: rgba(110, 0, 255, 0.4);
        }
        /* === BASE STYLES === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-dark);
            color: var(--text-light); min-height: 100vh; overflow-x: hidden;
            line-height: 1.6; position: relative;
        }
        /* === BACKGROUND EFFECTS === */
        .particles-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .particle { position: absolute; background: radial-gradient(circle, var(--primary) 0%, transparent 70%); border-radius: 50%; opacity: 0.6; animation: particle-anim linear infinite; }
        @keyframes particle-anim { 0%{transform:translateY(0) rotate(0deg);opacity:0;} 10%{opacity:0.6;} 100%{transform:translateY(-1500px) rotate(720deg);opacity:0;} }
        .grid-overlay, .scanlines, .glow-effect { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .grid-overlay { background-image: linear-gradient(rgba(110, 0, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(110, 0, 255, 0.05) 1px, transparent 1px); background-size: 40px 40px; }
        .scanlines { background: repeating-linear-gradient(0deg, rgba(0, 247, 255, 0.03), rgba(0, 247, 255, 0.03) 1px, transparent 1px, transparent 3px); animation: scanline 8s linear infinite; } @keyframes scanline { to{background-position:0 100%;} }
        .glow-effect { background: radial-gradient(circle at center, rgba(0, 247, 255, 0.05) 0%, transparent 70%); animation: pulse 8s infinite alternate; } @keyframes pulse { from { opacity: 0.3; transform: scale(0.95); } to { opacity: 0.7; transform: scale(1.05); } }
        /* === MAIN CONTAINER (Generator Page) === */
        .container {
            max-width: 900px; margin: 2rem auto; padding: 2.5rem;
            background: rgba(10, 10, 32, 0.85); backdrop-filter: blur(12px);
            border-radius: var(--border-radius); box-shadow: var(--box-shadow);
            border: 1px solid rgba(110, 0, 255, 0.3); position: relative; overflow: hidden;
            transition: var(--transition); animation: float 6s ease-in-out infinite;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .container::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at center, rgba(0, 247, 255, 0.1) 0%, transparent 60%); z-index: -1; animation: pulse 15s infinite alternate; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 2rem; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; font-size: 1.8rem; text-shadow: 0 0 15px rgba(0, 247, 255, 0.5); position: relative; padding-bottom: 1rem; }
        h1::after { content: ''; position: absolute; bottom: 0; left: 25%; width: 50%; height: 2px; background: linear-gradient(90deg, transparent, var(--primary), transparent); }
        h1 > .material-icons { vertical-align: middle; font-size: 2.2rem; margin-right: 0.5rem;}
        /* === GENERATOR FORM === */
        .generator-form { display: flex; flex-direction: column; gap: 1.8rem; margin-top: 2rem; }
        .input-group { position: relative; }
        .input-group label { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: var(--text-light); font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase; }
        .input-group .material-icons { font-size: 1.2rem; color: var(--secondary); }
        textarea#markdown-input, input[type="text"], input[type="url"] {
            width: 100%; padding: 1rem 1.5rem; background: var(--bg-light);
            border: 1px solid rgba(110, 0, 255, 0.5); border-radius: var(--border-radius);
            color: var(--text-light); font-size: 1rem; transition: var(--transition); outline: none;
            letter-spacing: 1px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        textarea#markdown-input { min-height: 180px; font-family: 'Consolas', 'Monaco', monospace; resize: vertical; line-height: 1.5; padding: 1.5rem; }
        textarea#markdown-input.error, input[type="text"].error, input[type="url"].error {
              border-color: var(--error) !important;
              box-shadow: 0 0 15px rgba(255, 61, 113, 0.5) !important;
         }
        textarea:focus, input[type="text"]:focus, input[type="url"]:focus {
            border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 247, 255, 0.5); transform: translateY(-2px);
        }
        input[type="text"].error, input[type="url"].error { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
         .container.shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        /* === BUTTONS (Generator Page) === */
        button { background: linear-gradient(135deg, var(--secondary), var(--primary)); color: white; border: none; padding: 1rem; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; transition: var(--transition); box-shadow: 0 4px 20px rgba(110, 0, 255, 0.4); position: relative; overflow: hidden; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(0, 247, 255, 0.6); }
        button:disabled { filter: grayscale(70%); opacity: 0.6; cursor: not-allowed; box-shadow: none; transform: none !important;}
        button::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%); transform: rotate(45deg); animation: shine 3s infinite linear; opacity: 0.5; }
        @keyframes shine { 0%{transform:translateX(-150%) rotate(45deg);} 100%{transform:translateX(150%) rotate(45deg);} }
        button > .material-icons { font-size: 1.4rem; }
        #copy-button { background: var(--bg-lighter); color: var(--text-dim); cursor: not-allowed; box-shadow: none; border: 1px solid rgba(110, 0, 255, 0.3); }
        #copy-button::before { display: none; }
        #copy-button:not(:disabled) { background: linear-gradient(135deg, #008040, var(--success)); box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4); color: white; cursor: pointer; filter: none; opacity: 1; }
        #copy-button:not(:disabled):hover { box-shadow: 0 6px 25px rgba(0, 255, 136, 0.6); transform: translateY(-3px); }
        #copy-button:not(:disabled)::before { display: block; }
        #copy-button.copied { background: var(--accent); box-shadow: 0 4px 20px rgba(255, 0, 170, 0.5); }
        #copy-button.copied > .material-icons { animation: spin 0.5s ease-in-out; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        /* === STATUS MESSAGE (Generator Page) === */
        .status-message { color: var(--success); text-align: center; margin-top: 1rem; font-size: 0.95rem; min-height: 1.5rem; height: auto; transition: all 0.3s ease; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: rgba(0, 255, 136, 0.1); padding: 0.8rem 1rem; border-radius: var(--border-radius); border-left: 4px solid var(--success); opacity: 0; visibility: hidden; max-height: 0; overflow: hidden; }
        .status-message.show { opacity: 1; visibility: visible; max-height: 100px; }
        .status-message.error { color: var(--error); border-left-color: var(--error); background: rgba(255, 61, 113, 0.1); }
        .status-message.info { color: var(--warning); border-left-color: var(--warning); background: rgba(255, 204, 0, 0.1); }
        .status-message .material-icons { font-size: 1.3rem; }
        /* === ICONS === */
        .material-icons { font-family: 'Material Icons'; font-weight: normal; font-style: normal; font-size: 20px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; -webkit-font-feature-settings: 'liga'; -webkit-font-smoothing: antialiased; vertical-align: middle; }
        /* === SECURITY WARNING MODAL (Generator Page) === */
        .warning-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(5, 5, 16, 0.9); backdrop-filter: blur(10px); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }
        .warning-modal.hidden { display: none !important; }
        .warning-modal:not(.hidden) { opacity: 1; pointer-events: auto; }
        .warning-content { background: var(--bg-dark); border: 1px solid var(--error); border-radius: var(--border-radius); padding: 2.5rem; max-width: 600px; width: 90%; box-shadow: 0 0 40px rgba(255, 61, 113, 0.3); position: relative; animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: scale(1); }
        .warning-modal:not(.hidden).initial-state .warning-content { transform: scale(0.9); opacity: 0;}
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .warning-title { color: var(--error); text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .warning-title .material-icons { font-size: 1.8rem; }
        .warning-message { color: var(--text-light); margin-bottom: 2rem; line-height: 1.7; }
        .warning-message p { margin-bottom: 1rem; } .warning-message strong { color: var(--warning); }
        .warning-message code { background: var(--bg-lighter); color: var(--accent); padding: 0.2em 0.4em; border-radius: 4px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9em; word-break: break-all; }
        .warning-message .material-icons { font-size: 1.1rem !important; vertical-align: text-bottom; margin-right: 0.3rem;}
        .warning-button { background: linear-gradient(135deg, var(--error), #ff6b8b); color: white; border: none; padding: 1rem; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; text-align: center; box-shadow: 0 4px 15px rgba(255, 61, 113, 0.4); }
        .warning-button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(255, 61, 113, 0.6); }
        .warning-button .material-icons { font-size: 1.4rem; }
        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) { .container { margin: 1rem; padding: 1.5rem; animation: none; } h1 { font-size: 1.5rem; } textarea#markdown-input { min-height: 150px; padding: 1rem; } input[type="text"], input[type="url"] { padding: 0.8rem 1rem; } button { padding: 0.8rem; font-size: 0.9rem; } .warning-content { padding: 1.5rem; max-width: 95%; } .warning-title { font-size: 1.3rem; } }
         @media (max-width: 480px) { h1 { font-size: 1.3rem; } .input-group label { font-size: 0.85rem; } .warning-message p { font-size: 0.95rem;} .warning-message code { font-size: 0.85em;} }
    </style>
</head>
<body>
    <!-- Generator Background Effects -->
    <div class="particles-container" id="particles"></div>
    <div class="grid-overlay"></div>
    <div class="scanlines"></div>
    <div class="glow-effect"></div>

    <!-- Generator Container -->
    <div class="container" id="generator-container">
        <h1><i class="material-icons">widgets</i> Mã Hóa Nội Dung & Nhúng Media</h1>
        <!-- Generator Form -->
        <form class="generator-form" id="main-form" onsubmit="return false;">
            <div class="input-group">
                <label for="markdown-input"><i class="material-icons">description</i> Nội Dung Chính (Markdown):</label>
                <textarea id="markdown-input" placeholder="Viết nội dung theo cú pháp Markdown..." required></textarea>
            </div>
            <div class="input-group">
                <label for="output-password-input"><i class="material-icons">key</i> Mật Khẩu Bảo Mật:</label>
                <input type="text" id="output-password-input" placeholder="Ít nhất 8 ký tự" required minlength="8">
            </div>
             <div class="input-group">
                 <label for="image-url-input"><i class="material-icons">image</i> URL Hình Ảnh (Tùy chọn):</label>
                 <input type="url" id="image-url-input" placeholder="Dán URL hình ảnh (VD: .../image.jpg)">
                 <small><i class="material-icons">info_outline</i> Hiển thị phía trên nội dung chính.</small>
             </div>
            <div class="input-group">
                <label for="iframe-url-input"><i class="material-icons">web_asset</i> URL Nhúng (Iframe - Tùy chọn):</label>
                <input type="url" id="iframe-url-input" placeholder="Dán URL trang web, video YouTube, Drive,...">
                 <small><i class="material-icons">info_outline</i> Hiển thị trong iframe bên dưới nội dung. Lưu ý chính sách nhúng của trang gốc.</small>
            </div>
            <button type="button" id="generate-button">
                <i class="material-icons">rocket_launch</i> Tạo Mã Nguồn Siêu Cấp
            </button>
            <button type="button" id="copy-button" disabled>
                <i class="material-icons">content_copy</i> Sao Chép Mã Nguồn
            </button>
            <div class="status-message" id="status-message"></div>
        </form>
    </div>

    <!-- Security Warning Modal Container -->
    <div class="warning-modal hidden" id="warning-modal"></div>

    <!-- ================================= -->
    <!-- === GENERATOR PAGE JAVASCRIPT === -->
    <!-- ================================= -->
    <script>
        // Element Selection
        const markdownInput = document.getElementById('markdown-input');
        const outputPasswordInput = document.getElementById('output-password-input');
        const imageUrlInput = document.getElementById('image-url-input');
        const iframeUrlInput = document.getElementById('iframe-url-input');
        const generateButton = document.getElementById('generate-button');
        const copyButton = document.getElementById('copy-button');
        const statusMessage = document.getElementById('status-message');
        const warningModal = document.getElementById('warning-modal');
        const particlesContainer = document.getElementById('particles');
        let fullHtmlToCopy = '';
        let statusTimeout = null;

        // --- Utility Functions ---
        function createParticles(container) {
            if (!container || (container.children.length > 50 && Math.random() < 0.95)) return;
            container.innerHTML = ''; const numParticles = window.innerWidth > 768 ? 150 : 75;
            for (let i = 0; i < numParticles; i++) { const p=document.createElement('div');p.classList.add('particle'); const s=Math.random()*4+1.5, x=Math.random()*window.innerWidth, d=Math.random()*10, dur=Math.random()*15+10, o=Math.random()*0.5+0.1; Object.assign(p.style,{width:\`\${s}px\`,height:\`\${s}px\`,left:\`\${x}px\`,bottom:\`-\${s}px\`,animationDuration:\`\${dur}s\`,animationDelay:\`\${d}s\`,opacity:o}); const c=['#00f7ff','#6e00ff','#ff00aa','#00ff88','#ffffff'];p.style.background=\`radial-gradient(circle, \${c[Math.floor(Math.random()*c.length)]} 0%, transparent 70%)\`;container.appendChild(p); }
        }
        function showStatus(message, type = "info", icon = "info", duration = 5000) {
            clearTimeout(statusTimeout); statusMessage.innerHTML = \`<i class="material-icons">\${icon}</i> \${message}\`; statusMessage.className='status-message'; requestAnimationFrame(()=>{statusMessage.classList.add(type,'show');}); if(duration>0){ statusTimeout=setTimeout(()=>statusMessage.classList.remove('show'), duration); }
        }
        function isValidUrl(string) { if (!string) return false; try { new URL(string); return true; } catch (_) { return false; } }

        // --- Encryption ---
        function multiLayerEncrypt(content, password, layers = 10) {
            let encrypted = content;
            for (let i = 0; i < layers; i++) { const comb=\`\${encrypted}|\${password}|\${i}\`, key=password+i; let enc; try { enc = CryptoJS.AES.encrypt(comb, key).toString(); } catch(e){ throw new Error(\`AES L\${i}: \${e.message}\`);} try { encrypted = btoa(unescape(encodeURIComponent(enc))); } catch(e){ throw new Error(\`B64 L\${i}: \${e.message}\`);} } return encrypted;
        }

        // --- HTML Template Generation ---
        function generateTargetHtmlTemplate(markdownContentHtml, pagePassword, imageUrl = null, iframeUrl = null) {
             let encryptedMarkdownHtml; try { encryptedMarkdownHtml = multiLayerEncrypt(markdownContentHtml, pagePassword, 10); } catch (e) { throw e; }
             const esc = (str) => str ? str.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\$/g, '\\$') : null;
             const escapedPassword=esc(pagePassword), escapedImageUrl=esc(imageUrl), escapedIframeUrl=esc(iframeUrl);
             const donate = \`🤫 Quên pass? Donate <strong>10K</strong> Momo/ZaloPay <strong>0901574726</strong> kèm lời nhắn & tớ sẽ cố giúp! 😉\`;
             const imgUrlJs=escapedImageUrl?\`\`${escapedImageUrl}\`\`:'null', iframeUrlJs=escapedIframeUrl?\`\`${escapedIframeUrl}\`\`:'null';

            return `<!DOCTYPE html>
<html lang="vi">
<head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Nội Dung Bảo Mật</title> <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"><\/script> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> <style>
:root{--primary:#00f7ff;--secondary:#6e00ff;--accent:#ff00aa;--error:#ff3d71;--success:#00ff88;--warning:#ffcc00;--bg-dark:#0a0a20;--bg-darker:#050510;--bg-light:rgba(20,20,50,0.5);--bg-lighter:rgba(30,30,70,0.3);--text-light:#e0e0ff;--text-lighter:#ffffff;--text-dim:rgba(224,224,255,0.6);--border-radius:12px;--box-shadow:0 0 30px rgba(0,247,255,0.2);--transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275);--media-border:rgba(0,247,255,0.3);--media-bg:rgba(10,10,32,0.7)}
*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--bg-dark);color:var(--text-light);min-height:100vh;overflow-x:hidden;line-height:1.6;position:relative;display:flex;align-items:center;justify-content:center;padding:1rem}
.particles-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;overflow:hidden}
.particle{position:absolute;background:radial-gradient(circle,var(--primary) 0%,transparent 70%);border-radius:50%;opacity:.6;animation:particle-anim linear infinite} @keyframes particle-anim{0%{transform:translateY(0) rotate(0deg);opacity:0}10%{opacity:.6}100%{transform:translateY(-1500px) rotate(720deg);opacity:0}}
.grid-overlay,.scanlines,.glow-effect{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none}
.grid-overlay{background-image:linear-gradient(rgba(110,0,255,.05) 1px,transparent 1px),linear-gradient(90deg,rgba(110,0,255,.05) 1px,transparent 1px);background-size:40px 40px}
.scanlines{background:repeating-linear-gradient(0deg,rgba(0,247,255,.03),rgba(0,247,255,.03) 1px,transparent 1px,transparent 3px);animation:scanline 8s linear infinite} @keyframes scanline{to{background-position:0 100%}}
.glow-effect{background:radial-gradient(circle at center,rgba(0,247,255,.05) 0%,transparent 70%);animation:pulse 8s infinite alternate} @keyframes pulse{from{opacity:.3;transform:scale(.95)}to{opacity:.7;transform:scale(1.05)}}
.container{max-width:950px;width:100%;margin:1rem auto;padding:2rem 2.5rem;background:rgba(10,10,32,.9);backdrop-filter:blur(12px);border-radius:var(--border-radius);box-shadow:var(--box-shadow);border:1px solid rgba(110,0,255,.3);position:relative;overflow:visible;transition:var(--transition);animation:floatTarget 7s ease-in-out infinite}
@keyframes floatTarget{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
.container::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at center,rgba(0,247,255,.1) 0%,transparent 60%);z-index:-1;animation:pulse 15s infinite alternate}
.page-title{text-align:center;color:var(--primary);margin-bottom:2rem;font-weight:300;letter-spacing:2px;text-transform:uppercase;font-size:1.6rem;text-shadow:0 0 15px rgba(0,247,255,.5);position:relative;padding-bottom:1rem;display:flex;align-items:center;justify-content:center;gap:.7rem}
.page-title .material-icons{font-size:2rem}
.page-title::after{content:'';position:absolute;bottom:0;left:30%;width:40%;height:2px;background:linear-gradient(90deg,transparent,var(--primary),transparent)}
#final-password-section{transition:opacity .5s ease,transform .5s ease,display 0s linear .5s}
#final-password-section.hiding{opacity:0;transform:scale(.9);pointer-events:none;display:flex!important}
.final-page-password-form{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem;max-width:400px;margin-left:auto;margin-right:auto}
.final-page-input-group label{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;color:var(--text-light);font-size:.9rem;letter-spacing:1px;text-transform:uppercase}
.final-page-input-group label .material-icons{color:var(--secondary);font-size:1.2rem}
.final-page-input-group input[type=password]{width:100%;padding:1rem 1.5rem;background:var(--bg-light);border:1px solid rgba(110,0,255,.5);border-radius:var(--border-radius);color:var(--text-light);font-size:1.1rem;transition:var(--transition);outline:none;letter-spacing:3px}
.final-page-input-group input[type=password]:focus{border-color:var(--primary);box-shadow:0 0 15px rgba(0,247,255,.5);transform:translateY(-2px)}
.final-page-button{background:linear-gradient(135deg,var(--secondary),var(--primary));color:#fff;border:none;padding:1rem;border-radius:var(--border-radius);cursor:pointer;font-size:1rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;transition:var(--transition);box-shadow:0 4px 20px rgba(110,0,255,.4);position:relative;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;gap:.5rem}
.final-page-button:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 6px 25px rgba(0,247,255,.6)}
.final-page-button:disabled{filter:grayscale(70%);opacity:.6;cursor:not-allowed;box-shadow:none;transform:none!important}
.final-page-button::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(to bottom right,transparent 0,rgba(255,255,255,.1) 50%,transparent 100%);transform:rotate(45deg);animation:shine 3s infinite linear;opacity:.5} @keyframes shine{to{transform:translateX(150%) rotate(45deg)}}
.final-page-error-message{color:var(--error);text-align:center;margin-top:0;margin-bottom:-.5rem;font-size:.95rem;min-height:2.5rem;font-weight:700;display:flex;align-items:center;justify-content:center;gap:.4rem;opacity:0;transition:opacity .3s ease;padding:.3rem .5rem}
.final-page-error-message.show{opacity:1} .final-page-error-message .material-icons{font-size:1.2rem}
.final-page-input-group input[type=password].shake{animation:shake-final .5s cubic-bezier(.36,.07,.19,.97) both;border-color:var(--error)}
@keyframes shake-final{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-6px)}20%,40%,60%,80%{transform:translateX(6px)}}
.final-page-donation-prompt{text-align:center;margin-top:1rem;padding:.8rem 1rem;background:rgba(255,204,0,.1);border-left:4px solid var(--warning);border-radius:var(--border-radius);color:var(--warning);font-size:.9rem;line-height:1.5;font-style:italic} .final-page-donation-prompt strong{font-weight:700;color:var(--text-lighter)}
#final-content-section{animation:fadeIn .8s ease-out;opacity:1;transition:opacity .5s ease}
#final-content-section.hidden{opacity:0;pointer-events:none;display:none!important} @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
#embedded-image-container{margin-bottom:2rem;padding:.5rem;background-color:var(--media-bg);border:1px solid var(--media-border);border-radius:var(--border-radius);box-shadow:0 5px 20px rgba(0,247,255,.1);display:block;opacity:0;max-height:0;overflow:hidden;transform:scale(.95);transition:opacity .5s ease,transform .5s ease,max-height .5s ease}
#embedded-image-container.visible{opacity:1;max-height:100vh;transform:scale(1)}
#embedded-image{display:block;max-width:100%;height:auto;margin:0 auto;border-radius:calc(var(--border-radius) - 4px);object-fit:contain}
.final-template-styles{line-height:1.75;color:var(--text-light);padding:0;max-width:100%;margin-bottom:2rem}
.final-template-styles>:first-child{margin-top:0!important} .final-template-styles>*:not(:last-child){margin-bottom:1.2rem}
.final-template-styles h1,.final-template-styles h2,.final-template-styles h3,.final-template-styles h4,.final-template-styles h5,.final-template-styles h6{font-weight:500;letter-spacing:1px;padding-bottom:.6rem;border-bottom:1px solid rgba(0,247,255,.2);margin-top:2.2rem;margin-bottom:1.2rem}
.final-template-styles h1{font-size:2.2rem;color:var(--primary);text-shadow:0 0 8px rgba(0,247,255,.5)}
.final-template-styles h2{font-size:1.8rem;color:var(--accent)} .final-template-styles h3{font-size:1.5rem;color:var(--success)} .final-template-styles h4{font-size:1.25rem}
.final-template-styles p{font-size:1.08rem;color:var(--text-lighter);margin-bottom:1.4rem}
.final-template-styles a{color:var(--accent);font-weight:600;text-decoration:none;border-bottom:1px solid transparent;transition:var(--transition);padding-bottom:1px}
.final-template-styles a:hover{color:var(--primary);border-bottom-color:var(--primary);text-shadow:0 0 5px var(--primary)}
.final-template-styles ul,.final-template-styles ol{margin-left:1.5rem;padding-left:1.2rem}
.final-template-styles li{margin-bottom:.7rem}
.final-template-styles ul li::marker{color:var(--primary);content:'✧ ';font-size:1.2em}
.final-template-styles ol{list-style-type:none;counter-reset:item} .final-template-styles ol li{counter-increment:item;margin-bottom:.7rem}
.final-template-styles ol li::before{content:counter(item);background:var(--secondary);color:#fff;border-radius:50%;width:1.6em;height:1.6em;display:inline-block;text-align:center;line-height:1.6em;font-weight:700;font-size:.85em;margin-right:.8em}
.final-template-styles blockquote{border-left:5px solid var(--secondary);padding:1.2rem 1.8rem;margin:2rem 0;background:var(--bg-lighter);border-radius:0 var(--border-radius) var(--border-radius) 0;font-style:italic;position:relative;overflow:hidden;box-shadow:inset 3px 0 10px rgba(110,0,255,.2)}
.final-template-styles blockquote::before{content:'“';font-family:Georgia,serif;font-size:3.5em;color:rgba(110,0,255,.2);position:absolute;left:10px;top:-10px}
.final-template-styles blockquote p{margin-bottom:.8rem;font-size:1.1rem}
.final-template-styles code:not(pre code){background:var(--bg-lighter);color:var(--accent);padding:.3em .6em;border-radius:4px;font-family:'Consolas','Monaco',monospace;font-size:.92em;border:1px solid rgba(255,0,170,.3)}
.final-template-styles pre{background:var(--bg-darker);padding:1.8rem;border-radius:var(--border-radius);overflow-x:auto;margin:2rem 0;border:1px solid var(--media-border);box-shadow:0 4px 15px rgba(0,0,0,.3),inset 0 0 10px rgba(0,247,255,.1)}
.final-template-styles pre code{background:0 0;padding:0;color:var(--text-lighter);font-size:.98em;line-height:1.65}
.final-template-styles hr{border:0;height:2px;background-image:linear-gradient(90deg,transparent,var(--accent),var(--primary),var(--accent),transparent);margin:3rem 0}
.final-template-styles table{width:100%;border-collapse:separate;border-spacing:0;margin:2rem 0;background:0 0;border:1px solid var(--media-border);border-radius:var(--border-radius);overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.2)}
.final-template-styles th,.final-template-styles td{border-bottom:1px solid var(--media-border);padding:1rem 1.2rem;text-align:left;background:var(--bg-light)}
.final-template-styles th{background:linear-gradient(135deg,var(--secondary),var(--accent));color:#fff;font-weight:600;text-transform:uppercase;font-size:.95em;border-bottom-width:2px;border-bottom-color:var(--primary)}
.final-template-styles td{color:var(--text-lighter)}
.final-template-styles tr:last-child td{border-bottom:none}
.final-template-styles tr:hover td{background-color:var(--bg-lighter);color:var(--primary)}
.final-template-styles img{max-width:100%;height:auto;border-radius:var(--border-radius);margin:1.5rem 0;box-shadow:0 8px 25px rgba(0,0,0,.4);border:1px solid var(--media-border);display:block}
#iframe-container{margin-top:2rem;border:1px solid var(--media-border);border-radius:var(--border-radius);overflow:hidden;background-color:var(--media-bg);box-shadow:0 5px 25px rgba(0,247,255,.15);display:block;position:relative;width:100%;padding-top:56.25%;opacity:0;max-height:0;transform:scale(.95);transition:opacity .5s ease,transform .5s ease,max-height .5s ease}
#iframe-container.visible{opacity:1;max-height:100vh;transform:scale(1)}
#embedded-iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none;border-radius:calc(var(--border-radius) - 1px)}
.warning-modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(5,5,16,.9);backdrop-filter:blur(10px);z-index:1000;display:flex;justify-content:center;align-items:center;opacity:0;transition:opacity .5s ease;pointer-events:none}
.warning-modal.hidden{display:none!important} .warning-modal:not(.hidden){opacity:1;pointer-events:auto}
.warning-content{background:var(--bg-dark);border:1px solid var(--error);border-radius:var(--border-radius);padding:2.5rem;max-width:600px;width:90%;box-shadow:0 0 40px rgba(255,61,113,.3);animation:scaleInFinal .5s cubic-bezier(.175,.885,.32,1.275);transform:scale(1)}
.warning-modal:not(.hidden).initial-state .warning-content{transform:scale(.9);opacity:0}
@keyframes scaleInFinal{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}
.warning-title{color:var(--error);text-align:center;margin-bottom:1.5rem;font-size:1.5rem;text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;justify-content:center;gap:.5rem}
.warning-title .material-icons{font-size:1.8rem}
.warning-message{color:var(--text-light);margin-bottom:2rem;line-height:1.7} .warning-message p{margin-bottom:1rem} .warning-message strong{color:var(--warning)}
.warning-button{background:linear-gradient(135deg,var(--error),#ff6b8b);color:#fff;border:none;padding:1rem;border-radius:var(--border-radius);cursor:pointer;font-size:1rem;font-weight:700;width:100%;display:flex;align-items:center;justify-content:center;gap:.5rem;box-shadow:0 4px 15px rgba(255,61,113,.4);transition:var(--transition)}
.warning-button:hover{transform:translateY(-3px);box-shadow:0 6px 25px rgba(255,61,113,.6)}
.hidden{display:none!important} .text-center{text-align:center}
.footer-note{text-align:center;margin-top:2.5rem;font-size:.85rem;color:var(--text-dim);opacity:.7}
.footer-note .material-icons{font-size:1rem;vertical-align:text-bottom}
.spin{animation:spin 1s linear infinite} @keyframes spin{to{transform:rotate(1turn)}}
@media (max-width:768px){.container{padding:1.5rem}.page-title{font-size:1.4rem}#iframe-container{padding-top:75%}}
@media (max-width:480px){.final-page-password-form{gap:1.2rem}.final-page-input-group input[type=password]{padding:.8rem 1rem}.page-title{font-size:1.3rem}.warning-title{font-size:1.3rem}.warning-content{padding:1.5rem}}
</style>
</head>
<body>
    <div class="particles-container" id="final-particles"></div> <div class="grid-overlay"></div> <div class="scanlines"></div> <div class="glow-effect"></div>
    <div class="container">
        <div id="final-password-section">
            <h1 class="page-title"><i class="material-icons">lock_person</i> Truy Cập Vùng Dữ Liệu</h1>
            <form class="final-page-password-form" id="password-form" onsubmit="checkFinalPagePassword(event)">
                <div class="final-page-input-group"> <label for="final-password-input"><i class="material-icons">password</i> Mã Truy Cập:</label> <input type="password" id="final-password-input" placeholder="••••••••••••" autocomplete="current-password" required> </div>
                <div class="final-page-donation-prompt">${donate}</div>
                <button type="submit" class="final-page-button" id="final-submit-btn"> <i class="material-icons">sensors</i> Giải Mã & Hiển Thị </button>
                <div class="final-page-error-message" id="final-error-message"></div>
            </form>
        </div>
        <div id="final-content-section" class="hidden">
             <div id="embedded-image-container"> <img id="embedded-image" src="about:blank" alt="Hình ảnh nhúng"> </div>
             <div class="final-template-styles" id="final-markdown-content"></div>
             <div id="iframe-container"> <iframe id="embedded-iframe" title="Embedded Content" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe> </div>
             <div class="footer-note"><i class="material-icons">verified_user</i> Nội dung bảo mật bởi 10 lớp AES.</div>
        </div>
    </div>
    <div class="warning-modal hidden initial-state" id="final-warning-modal">
         <div class="warning-content"> <h2 class="warning-title"><i class="material-icons">gpp_bad</i> CẢNH BÁO</h2> <div class="warning-message"> <p>Truy cập vùng dữ liệu mã hóa cao.</p> <p>Mọi hành vi trái phép có thể bị ghi nhận.</p> <p><strong>Bảo mật thông tin!</strong></p> </div> <button class="warning-button" id="final-warning-confirm"> <i class="material-icons">check_circle_outline</i> ĐÃ HIỂU </button> </div>
    </div>
    <script>
    const encryptedMarkdownContent=\`${encryptedMarkdownHtml}\`;const embeddedImageUrl=${imgUrlJs};const embeddedIframeUrl=${iframeUrlJs};
    const finalPasswordSection=document.getElementById("final-password-section"),finalContentSection=document.getElementById("final-content-section"),finalPasswordInput=document.getElementById("final-password-input"),finalErrorMessage=document.getElementById("final-error-message"),finalImageContainer=document.getElementById("embedded-image-container"),finalImagePlayer=document.getElementById("embedded-image"),finalMarkdownContentDiv=document.getElementById("final-markdown-content"),finalIframeContainer=document.getElementById("iframe-container"),finalIframePlayer=document.getElementById("embedded-iframe"),finalWarningModal=document.getElementById("final-warning-modal"),finalWarningConfirmBtn=document.getElementById("final-warning-confirm"),finalParticlesContainer=document.getElementById("final-particles"),submitButton=document.getElementById("final-submit-btn");
    function createFinalParticles(){if(!finalParticlesContainer||finalParticlesContainer.children.length>40)return;finalParticlesContainer.innerHTML="";const e=window.innerWidth>768?120:60;for(let t=0;t<e;t++){const e=document.createElement("div");e.classList.add("particle");const n=4*Math.random()+1,o=Math.random()*window.innerWidth,a=12*Math.random(),r=18*Math.random()+12,i=.4*Math.random()+.1;Object.assign(e.style,{width:\`\${n}px\`,height:\`\${n}px\`,left:\`\${o}px\`,bottom:\`-\${n}px\`,animationDuration:\`\${r}s\`,animationDelay:\`\${a}s\`,opacity:i});const l=["#00f7ff","#6e00ff","#ff00aa"],d=l[Math.floor(Math.random()*l.length)];e.style.background=\`radial-gradient(circle, \${d} 0%, transparent 70%)\`,finalParticlesContainer.appendChild(e)}}
    function multiLayerDecrypt(e,t,n=10){if("undefined"==typeof CryptoJS)throw new Error("Lỗi thư viện mã hóa.");let o=e;try{for(let e=n-1;e>=0;e--){let n=decodeURIComponent(escape(atob(o))),a=t+e,r=CryptoJS.AES.decrypt(n,a),i=r.toString(CryptoJS.enc.Utf8);if(!i)throw new Error(\`Giải mã lớp \${e} thất bại - Sai mật khẩu?\`);const l=i.split("|");if(l.length<3||l[1]!==t)throw new Error(\`Xác thực lớp \${e} thất bại - Sai mật khẩu?\`);o=l[0]}return o}catch(e){throw console.error("Lỗi giải mã:",e.message),e}}
    function showFinalError(e){finalErrorMessage.innerHTML=\`<i class="material-icons">warning</i> \${e||"Lỗi không xác định"}\`,finalErrorMessage.classList.add("show"),finalPasswordInput.classList.add("shake"),setTimeout(()=>finalPasswordInput.classList.remove("shake"),500)}
    function checkFinalPagePassword(e){e&&e.preventDefault();const t=finalPasswordInput.value;if(finalErrorMessage.classList.remove("show"),finalPasswordInput.classList.remove("shake"),!t)return showFinalError("Vui lòng nhập mã."),void finalPasswordInput.focus();submitButton.disabled=!0,submitButton.innerHTML='<i class="material-icons spin">hourglass_top</i> Đang xử lý...',setTimeout(()=>{try{const e=multiLayerDecrypt(encryptedMarkdownContent,t,10);finalMarkdownContentDiv.innerHTML=e,embeddedImageUrl&&"string"==typeof embeddedImageUrl?(finalImagePlayer.onload=()=>console.log("Image loaded:",embeddedImageUrl),finalImagePlayer.onerror=()=>{console.error("Image failed:",embeddedImageUrl),finalImagePlayer.alt="Lỗi tải hình ảnh",finalImageContainer.classList.add("visible")},finalImagePlayer.src=embeddedImageUrl,finalImageContainer.classList.add("visible")):(finalImageContainer.classList.remove("visible"),finalImagePlayer.src="about:blank"),embeddedIframeUrl&&"string"==typeof embeddedIframeUrl?(finalIframePlayer.onload=()=>console.log("Iframe loaded:",embeddedIframeUrl),finalIframePlayer.onerror=()=>console.error("Iframe failed:",embeddedIframeUrl),finalIframePlayer.src=embeddedIframeUrl,finalIframeContainer.classList.add("visible")):(finalIframeContainer.classList.remove("visible"),finalIframePlayer.src="about:blank"),finalPasswordSection.classList.add("hiding"),finalContentSection.classList.remove("hidden"),finalPasswordSection.addEventListener("transitionend",()=>{finalPasswordSection.style.display="none",(finalContentSection.querySelector("h1, h2, h3")||finalImagePlayer||finalContentSection).focus({preventScroll:!0})},{once:!0}),console.log("Mở khóa và hiển thị thành công.")}catch(e){showFinalError(e.message||"Mật khẩu sai hoặc dữ liệu lỗi."),finalPasswordInput.value="",finalPasswordInput.focus()}finally{submitButton.disabled=!1,submitButton.innerHTML='<i class="material-icons">sensors</i> Giải Mã & Hiển Thị'}},100)}
    document.addEventListener("DOMContentLoaded",function(){createFinalParticles(),finalWarningModal&&finalWarningConfirmBtn?(finalWarningModal.classList.remove("hidden","initial-state"),finalWarningConfirmBtn.onclick=()=>{finalWarningModal.classList.add("hidden"),finalPasswordInput.focus()},finalWarningModal.onclick=e=>{e.target===finalWarningModal&&finalWarningConfirmBtn.click()}):finalPasswordInput.focus(),finalPasswordInput.addEventListener("keydown",e=>{"Enter"===e.key&&checkFinalPagePassword(e)}),finalContentSection.setAttribute("tabindex","-1"),document.getElementById("spin-anim")||(()=>{const e=document.createElement("style");e.id="spin-anim",e.innerHTML="@keyframes spin{to{transform:rotate(1turn)}}.spin{animation:spin 1s linear infinite}",document.head.appendChild(e)})()});let finalResizeTimeout;window.addEventListener("resize",()=>{clearTimeout(finalResizeTimeout),finalResizeTimeout=setTimeout(createFinalParticles,300)});
    <\/script>
</body>
</html>`;
        }


        // ====== GENERATOR PAGE FUNCTIONS ======
        function handleGenerate() {
            const markdownText = markdownInput.value.trim();
            const outputPassword = outputPasswordInput.value;
            const imageUrl = imageUrlInput.value.trim();
            const iframeUrl = iframeUrlInput.value.trim();

            // Clear errors
            markdownInput.classList.remove('error'); outputPasswordInput.classList.remove('error');
            imageUrlInput.classList.remove('error'); iframeUrlInput.classList.remove('error');

            // Validation
            let isValid = true;
            if (!markdownText) { showStatus("Nội dung Markdown trống.", "error", "edit_note", 6000); markdownInput.classList.add('error'); if(isValid) markdownInput.focus(); isValid = false; }
            if (!outputPassword || outputPassword.length < 8) { showStatus("Mật khẩu cần ít nhất 8 ký tự.", "error", "password", 6000); outputPasswordInput.classList.add('error'); if(isValid) outputPasswordInput.focus(); isValid = false; }
            if (imageUrl && !isValidUrl(imageUrl)) { showStatus("URL hình ảnh không hợp lệ.", "error", "broken_image", 7000); imageUrlInput.classList.add('error'); if(isValid) imageUrlInput.focus(); isValid = false; }
            if (iframeUrl && !isValidUrl(iframeUrl)) { showStatus("URL nội dung nhúng không hợp lệ.", "error", "link_off", 7000); iframeUrlInput.classList.add('error'); if(isValid) iframeUrlInput.focus(); isValid = false; }

            if (!isValid) { document.getElementById('generator-container').classList.add('shake'); setTimeout(() => document.getElementById('generator-container').classList.remove('shake'), 500); return; }

            // Process & Generate
            try {
                if (typeof marked === 'undefined') throw new Error("MarkedJS lỗi tải.");
                marked.setOptions({ breaks: true, gfm: true, mangle: false, headerIds: false });
                const convertedHtml = marked.parse(markdownText);

                // Show confirmation
                loadAndShowWarningModal(() => {
                    showStatus("Đang tạo mã nguồn... ", "info", "sync", 0);
                    generateButton.disabled = true; copyButton.disabled = true;
                    setTimeout(() => {
                        try {
                            fullHtmlToCopy = generateTargetHtmlTemplate( convertedHtml, outputPassword, imageUrl || null, iframeUrl || null );
                            showStatus("Tạo mã nguồn thành công!", "success", "rocket_launch", 5000);
                            copyButton.disabled = false; copyButton.classList.remove('copied'); copyButton.innerHTML = '<i class="material-icons">content_copy</i> Sao Chép';
                            console.log(`HTML Generated (Img: ${!!imageUrl}, Iframe: ${!!iframeUrl})`);
                        } catch (genError) { showStatus(`Lỗi tạo HTML: ${genError.message}`, "error", "error", 8000); fullHtmlToCopy = ''; copyButton.disabled = true; }
                        finally { generateButton.disabled = false; }
                    }, 50);
                });
            } catch (procError) { showStatus(`Lỗi xử lý: ${procError.message}`, "error", "error", 8000); fullHtmlToCopy=''; copyButton.disabled=true; generateButton.disabled=false; }
        }

        // Copy function
        function handleCopy() {
             if (!fullHtmlToCopy) { showStatus("Chưa có gì để sao chép.", "info", "info"); return; }
             if (!navigator.clipboard?.writeText) { showStatus("Trình duyệt không hỗ trợ sao chép.", "error", "report_problem", 7000); console.warn("Clipboard API failed. Code:", fullHtmlToCopy); return; }
             navigator.clipboard.writeText(fullHtmlToCopy).then(() => { showStatus("Đã sao chép mã nguồn!", "success", "done_all", 3000); copyButton.classList.add('copied'); copyButton.innerHTML = '<i class="material-icons">check_circle</i> Đã Chép!'; setTimeout(() => { if(copyButton.classList.contains('copied')) { copyButton.classList.remove('copied'); copyButton.innerHTML = '<i class="material-icons">content_copy</i> Sao Chép'; } }, 3000); }).catch(err => { console.error('Lỗi sao chép:', err); showStatus("Không thể sao chép!", "error", "report_problem"); });
        }

        // Load/Show Warning Modal
        function loadAndShowWarningModal(onConfirmCallback) {
             const imgUrl = imageUrlInput.value.trim(); const ifrUrl = iframeUrlInput.value.trim();
             const modalHtml = `<div class="warning-content"> <h2 class="warning-title"><i class="material-icons">security</i> XÁC NHẬN TẠO MÃ</h2> <div class="warning-message"> <p>Nội dung và media (nếu có) sẽ được mã hóa <strong>10 lớp AES</strong>.</p> ${imgUrl ? `<p style="color:var(--success);"><i class="material-icons">image</i> <strong>Hình ảnh:</strong><br><code title="${imgUrl}">${imgUrl.length > 100 ? imgUrl.substring(0, 97) + '...' : imgUrl}</code></p>` : '<p style="color:var(--text-dim);"><i class="material-icons">hide_image</i> <em>(Không nhúng hình ảnh.)</em></p>'} ${ifrUrl ? `<p style="color:var(--accent);"><i class="material-icons">link</i> <strong>Iframe URL:</strong><br><code title="${ifrUrl}">${ifrUrl.length > 100 ? ifrUrl.substring(0, 97) + '...' : ifrUrl}</code></p>` : '<p style="color:var(--text-dim);"><i class="material-icons">link_off</i> <em>(Không nhúng iframe.)</em></p>'} <p style="margin-top:1.5rem;">Kiểm tra kỹ thông tin & mật khẩu!</p> </div> <button class="warning-button" id="warning-confirm-dynamic"> <i class="material-icons">check_circle</i> OK, TIẾP TỤC TẠO! </button> </div>`;
             warningModal.innerHTML = modalHtml;
             const confirmBtn = warningModal.querySelector('#warning-confirm-dynamic'), wc = warningModal.querySelector('.warning-content');
             const newConfirmBtn = confirmBtn.cloneNode(true); wc.replaceChild(newConfirmBtn, confirmBtn);
             newConfirmBtn.onclick = () => { warningModal.classList.add('hidden'); if (typeof onConfirmCallback === 'function') setTimeout(onConfirmCallback, 50); };
             const clickHandler = (e) => { if (e.target === warningModal) warningModal.classList.add('hidden'); };
             warningModal.removeEventListener('click', clickHandler); warningModal.addEventListener('click', clickHandler);
             warningModal.classList.add('initial-state'); warningModal.classList.remove('hidden'); requestAnimationFrame(() => warningModal.classList.remove('initial-state'));
         }

        // ====== INITIALIZATION (Generator Page) ======
        document.addEventListener('DOMContentLoaded', function() {
            createParticles(particlesContainer);
            generateButton.addEventListener('click', handleGenerate);
            copyButton.addEventListener('click', handleCopy);
            [markdownInput, outputPasswordInput, imageUrlInput, iframeUrlInput].forEach(i => i.addEventListener('input', () => i.classList.remove('error')));
            showStatus("🔧 Sẵn sàng mã hóa & nhúng media!", "info", "auto_awesome", 7000);
            let rt; window.addEventListener('resize', () => { clearTimeout(rt); rt = setTimeout(() => createParticles(particlesContainer), 300); });
             // Inject shake animation style
             if (!document.getElementById('shake-style')) { const s=document.createElement('style');s.id='shake-style';s.innerHTML='@keyframes shake{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-5px)}20%,40%,60%,80%{transform:translateX(5px)}}.container.shake{animation:shake .5s cubic-bezier(.36,.07,.19,.97) both}'; document.head.appendChild(s); }
        });
    </script>
</body>
</html>
