<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12A2 TOOLS - T·∫°o HTML B·∫£o M·∫≠t N√¢ng Cao</title>
    <!-- Th∆∞ vi·ªán chuy·ªÉn ƒë·ªïi Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Th∆∞ vi·ªán m√£ h√≥a/gi·∫£i m√£ (CHO TRANG G·ªêC N√ÄY) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Font Icon -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary: #00f7ff; --secondary: #6e00ff; --accent: #ff00aa;
            --error: #ff3d71; --success: #00ff88; --warning: #ffcc00;
            --bg-dark: #0a0a20; --bg-darker: #050510; --bg-light: rgba(20, 20, 50, 0.5);
            --bg-lighter: rgba(30, 30, 70, 0.3); --text-light: #e0e0ff;
            --text-lighter: #ffffff; --text-dim: rgba(224, 224, 255, 0.6);
            --border-radius: 12px; --box-shadow: 0 0 30px rgba(0, 247, 255, 0.2);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
        }

        /* Background Effects */
        .particles-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden;
        }
        .particle {
            position: absolute; background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            border-radius: 50%; opacity: 0.6; animation: particle-anim linear infinite;
        }
        @keyframes particle-anim {
            0%{transform:translateY(0) rotate(0deg);opacity:0;}
            10%{opacity:0.6;}
            100%{transform:translateY(-1500px) rotate(720deg);opacity:0;}
        }
        .grid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(110, 0, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(110, 0, 255, 0.05) 1px, transparent 1px);
            background-size: 40px 40px; z-index: -1; pointer-events: none;
        }
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0, 247, 255, 0.03), rgba(0, 247, 255, 0.03) 1px, transparent 1px, transparent 3px);
            z-index: -1; pointer-events: none; animation: scanline 8s linear infinite;
        }
        @keyframes scanline {
            0%{background-position:0 0;}
            100%{background-position:0 100%;}
        }
        .glow-effect {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(0, 247, 255, 0.05) 0%, transparent 70%);
            z-index: -1; pointer-events: none; animation: pulse 8s infinite alternate;
        }
        @keyframes pulse {
            0% { opacity: 0.3; transform: scale(0.95); }
            100% { opacity: 0.7; transform: scale(1.05); }
        }

        /* Main Container */
        .container {
            max-width: 900px; margin: 2rem auto; padding: 2.5rem;
            background: rgba(10, 10, 32, 0.85); backdrop-filter: blur(12px);
            border-radius: var(--border-radius); box-shadow: var(--box-shadow);
            border: 1px solid rgba(110, 0, 255, 0.3); position: relative; overflow: hidden;
            transition: var(--transition); animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .container::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle at center, rgba(0, 247, 255, 0.1) 0%, transparent 60%);
            z-index: -1; animation: pulse 15s infinite alternate; /* Different pulse for container bg */
        }
        h1 {
            text-align: center; color: var(--primary); margin-bottom: 2rem; font-weight: 300;
            letter-spacing: 2px; text-transform: uppercase; font-size: 1.8rem;
            text-shadow: 0 0 15px rgba(0, 247, 255, 0.5); position: relative; padding-bottom: 1rem;
        }
        h1::after {
            content: ''; position: absolute; bottom: 0; left: 25%; width: 50%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }
        h1 > .material-icons { vertical-align: middle; font-size: 2.2rem; margin-right: 0.5rem;} /* Icon styling */

        /* Generator Form */
        .generator-form { display: flex; flex-direction: column; gap: 1.5rem; margin-top: 2rem; }
        .input-group { position: relative; } /* For potential future icon positioning */
        .input-group label {
            display: flex; align-items: center; gap: 0.5rem;
            margin-bottom: 0.5rem; color: var(--text-light); font-size: 0.9rem;
            letter-spacing: 1px; text-transform: uppercase;
        }
        .input-group .material-icons { font-size: 1.2rem; color: var(--secondary); } /* Label icons */
        textarea#markdown-input {
            width: 100%; min-height: 200px; padding: 1.5rem; background: var(--bg-light);
            border: 1px solid rgba(110, 0, 255, 0.5); border-radius: var(--border-radius);
            color: var(--text-lighter); font-size: 1rem; font-family: 'Consolas', 'Monaco', monospace;
            transition: var(--transition); outline: none; letter-spacing: 1px; resize: vertical; line-height: 1.5;
        }
        textarea#markdown-input:focus {
            border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 247, 255, 0.5); transform: translateY(-2px);
        }
        input[type="text"]#output-password-input {
             width: 100%; padding: 1rem 1.5rem; background: var(--bg-light);
             border: 1px solid rgba(110, 0, 255, 0.5); border-radius: var(--border-radius);
             color: var(--text-light); font-size: 1rem; transition: var(--transition); outline: none;
             letter-spacing: 1px;
         }
         input[type="text"]#output-password-input:focus {
             border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 247, 255, 0.5); transform: translateY(-2px);
         }
         input[type="text"]#output-password-input.error {
             border-color: var(--error) !important; /* Ensure error border shows */
             box-shadow: 0 0 15px rgba(255, 61, 113, 0.5) !important; /* Ensure error shadow shows */
             animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; /* Shake on error */
         }
        @keyframes shake {
            0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Button Styles */
        button {
            background: linear-gradient(135deg, var(--secondary), var(--primary)); color: white; border: none;
            padding: 1rem; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: bold;
            text-transform: uppercase; letter-spacing: 1px; transition: var(--transition);
            box-shadow: 0 4px 20px rgba(110, 0, 255, 0.4); position: relative; overflow: hidden;
            display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(0, 247, 255, 0.6); }
        button::before { /* Shine effect */
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            transform: rotate(45deg); animation: shine 3s infinite linear; opacity: 0.5;
        }
        @keyframes shine {
            0%{transform:translateX(-150%) rotate(45deg);} 100%{transform:translateX(150%) rotate(45deg);}
        }
        button > .material-icons { font-size: 1.4rem; } /* Button icons */

        /* Copy Button Specifics */
        #copy-button {
            background: var(--bg-lighter); color: var(--text-dim); cursor: not-allowed;
            box-shadow: none; opacity: 0.5; border: 1px solid rgba(110, 0, 255, 0.3);
        }
        #copy-button::before { display: none; } /* Hide shine when disabled */
        #copy-button:not(:disabled) {
            background: linear-gradient(135deg, #008040, var(--success)); /* Green gradient when enabled */
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4); opacity: 1; color: white; cursor: pointer;
        }
        #copy-button:not(:disabled):hover {
            box-shadow: 0 6px 25px rgba(0, 255, 136, 0.6); transform: translateY(-3px);
        }
        #copy-button:not(:disabled)::before { display: block; } /* Show shine when enabled */
        #copy-button.copied {
            background: var(--accent); /* Pink when copied */
            box-shadow: 0 4px 20px rgba(255, 0, 170, 0.5);
        }
        #copy-button.copied > .material-icons { animation: spin 0.5s ease-in-out; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }


        /* Status Message */
        .status-message {
            color: var(--success); text-align: center; margin-top: 1rem; font-size: 0.95rem; /* Slightly larger */
            height: 1.5rem; transition: all 0.3s ease; font-weight: bold; display: flex;
            align-items: center; justify-content: center; gap: 0.5rem;
            background: rgba(0, 255, 136, 0.1); padding: 0.5rem 1rem; border-radius: var(--border-radius);
            border-left: 4px solid var(--success); opacity: 0; visibility: hidden; /* Start hidden */
        }
        .status-message.show { opacity: 1; visibility: visible; } /* Animate in */
        .status-message.error {
            color: var(--error); border-left-color: var(--error); background: rgba(255, 61, 113, 0.1);
        }
        .status-message.info {
            color: var(--warning); border-left-color: var(--warning); background: rgba(255, 204, 0, 0.1);
        }
        .status-message .material-icons { font-size: 1.3rem; } /* Status icons */

        /* Icons - Material Icons (already linked in <head>) */
        .material-icons {
            font-family: 'Material Icons'; font-weight: normal; font-style: normal; font-size: 20px;
            line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block;
            white-space: nowrap; word-wrap: normal; direction: ltr;
            -webkit-font-feature-settings: 'liga'; -webkit-font-smoothing: antialiased; vertical-align: middle;
        }

        /* Security Warning Modal */
        .warning-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(5, 5, 16, 0.9); backdrop-filter: blur(10px);
            z-index: 1000; display: flex; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.5s ease; pointer-events: none; /* Start hidden and non-interactive */
        }
        .warning-modal:not(.hidden) {
            opacity: 1; pointer-events: auto; /* Show and make interactive */
        }
        .warning-content {
            background: var(--bg-dark); border: 1px solid var(--error);
            border-radius: var(--border-radius); padding: 2.5rem; max-width: 600px; width: 90%;
            box-shadow: 0 0 40px rgba(255, 61, 113, 0.3); position: relative;
            animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Entry animation */
            transform: scale(0.9); /* Start smaller for animation */
        }
        .warning-modal:not(.hidden) .warning-content {
            transform: scale(1); /* Animate to full size */
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .warning-title {
            color: var(--error); text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem;
            text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center;
            justify-content: center; gap: 0.5rem;
        }
        .warning-title .material-icons { font-size: 1.8rem; }
        .warning-message { color: var(--text-light); margin-bottom: 2rem; line-height: 1.7; }
        .warning-message p { margin-bottom: 1rem; }
        .warning-message strong { color: var(--warning); }
        .warning-button {
            background: linear-gradient(135deg, var(--error), #ff6b8b); color: white; border: none;
            padding: 1rem; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: bold;
            text-transform: uppercase; letter-spacing: 1px; transition: var(--transition);
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            width: 100%; text-align: center;
            box-shadow: 0 4px 15px rgba(255, 61, 113, 0.4);
        }
        .warning-button:hover { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(255, 61, 113, 0.6); }
        .warning-button .material-icons { font-size: 1.4rem; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container { margin: 1rem; padding: 1.5rem; animation: none; } /* Disable float on mobile */
            h1 { font-size: 1.5rem; }
            textarea#markdown-input { min-height: 180px; padding: 1rem; }
            input[type="text"]#output-password-input { padding: 0.8rem 1rem; }
            button { padding: 0.8rem; font-size: 0.9rem; }
            .warning-content { padding: 1.5rem; max-width: 95%; }
            .warning-title { font-size: 1.3rem; }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="particles-container" id="particles"></div>
    <div class="grid-overlay"></div>
    <div class="scanlines"></div>
    <div class="glow-effect"></div>

    <!-- Generator Container -->
    <div class="container" id="generator-container">
        <h1><i class="material-icons">security</i> Markdown to Secure HTML</h1>

        <div class="generator-form">
            <div class="input-group">
                <label for="markdown-input"><i class="material-icons">description</i> N·ªôi Dung Markdown:</label>
                <textarea id="markdown-input" placeholder="Nh·∫≠p n·ªôi dung Markdown v√†o ƒë√¢y..."></textarea>
            </div>

            <div class="input-group">
                <label for="output-password-input"><i class="material-icons">key</i> ƒê·∫∑t M·∫≠t Kh·∫©u B·∫£o M·∫≠t:</label>
                <input type="text" id="output-password-input" placeholder="√çt nh·∫•t 8 k√Ω t·ª±, b·∫£o m·∫≠t m·∫°nh!">
            </div>

            <button type="button" id="generate-button">
                <i class="material-icons">enhanced_encryption</i> T·∫°o M√£ Ngu·ªìn B·∫£o M·∫≠t
            </button>

            <button type="button" id="copy-button" disabled>
                <i class="material-icons">content_copy</i> Sao Ch√©p M√£ Ngu·ªìn
            </button>

            <div class="status-message" id="status-message">
                <!-- Status messages appear here -->
            </div>
        </div>
    </div>

    <!-- Security Warning Modal (Hidden initially) -->
    <div class="warning-modal hidden" id="warning-modal">
        <div class="warning-content">
            <h2 class="warning-title"><i class="material-icons">warning</i> C·∫¢NH B√ÅO B·∫¢O M·∫¨T</h2>
            <div class="warning-message">
                <p>N·ªôi dung s·∫Øp ƒë∆∞·ª£c t·∫°o s·∫Ω ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi <strong>10 l·ªõp m√£ h√≥a AES</strong>. M·∫≠t kh·∫©u b·∫°n ƒë·∫∑t l√† ch√¨a kh√≥a duy nh·∫•t.</p>
                <p>Vi·ªác chia s·∫ª ho·∫∑c c·ªë g·∫Øng ph√° v·ª° m√£ h√≥a n√†y c√≥ th·ªÉ vi ph·∫°m c√°c quy ƒë·ªãnh v·ªÅ b·∫£o m·∫≠t th√¥ng tin.</p>
                <p>H√£y ƒë·∫£m b·∫£o b·∫°n gi·ªØ m·∫≠t kh·∫©u an to√†n v√† ch·ªâ chia s·∫ª file HTML cho nh·ªØng ng∆∞·ªùi ƒë∆∞·ª£c ph√©p.</p>
            </div>
            <button class="warning-button" id="warning-confirm">
                <i class="material-icons">check_circle</i> T√îI HI·ªÇU V√Ä TI·∫æP T·ª§C
            </button>
        </div>
    </div>

    <script>
        // ====== CONFIGURATION & ELEMENTS ======
        const markdownInput = document.getElementById('markdown-input');
        const outputPasswordInput = document.getElementById('output-password-input');
        const generateButton = document.getElementById('generate-button');
        const copyButton = document.getElementById('copy-button');
        const statusMessage = document.getElementById('status-message');
        const warningModal = document.getElementById('warning-modal');
        const warningConfirm = document.getElementById('warning-confirm');
        const particlesContainer = document.getElementById('particles'); // Generator page particles
        let fullHtmlToCopy = '';
        let statusTimeout = null; // To manage status message clearing

        // ====== UTILITY FUNCTIONS ======
        function createParticles(container, idPrefix = '') {
             if (!container) return;
             container.innerHTML = ''; // Clear existing
             const numParticles = window.innerWidth > 768 ? 150 : 75;

             for (let i = 0; i < numParticles; i++) {
                 const particle = document.createElement('div');
                 particle.classList.add('particle');
                 if(idPrefix) particle.id = `${idPrefix}-particle-${i}`; // Unique ID if needed

                 const size = Math.random() * 6 + 2;
                 const posX = Math.random() * window.innerWidth;
                 const delay = Math.random() * 10;
                 const duration = Math.random() * 15 + 10;
                 const opacity = Math.random() * 0.5 + 0.1;

                 particle.style.width = `${size}px`;
                 particle.style.height = `${size}px`;
                 particle.style.left = `${posX}px`;
                 particle.style.bottom = `-${size}px`;
                 particle.style.animationDuration = `${duration}s`;
                 particle.style.animationDelay = `${delay}s`;
                 particle.style.opacity = opacity;

                 // Randomize colors for more visual interest
                 const colors = ['#00f7ff', '#6e00ff', '#ff00aa', '#00ff88', '#ffcc00', '#ffffff'];
                 const color = colors[Math.floor(Math.random() * colors.length)];
                 particle.style.background = `radial-gradient(circle, ${color} 0%, transparent 70%)`;

                 container.appendChild(particle);
             }
        }

        function showStatus(message, type = "info", icon = "info", duration = 5000) {
             clearTimeout(statusTimeout); // Clear previous timeout if any
             statusMessage.innerHTML = `<i class="material-icons">${icon}</i> ${message}`;
             statusMessage.className = 'status-message'; // Reset classes
             statusMessage.classList.add(type); // Add specific type class (error, success, info)
             statusMessage.classList.add('show'); // Make it visible with animation

             if (duration > 0) {
                statusTimeout = setTimeout(() => {
                     statusMessage.classList.remove('show'); // Hide it
                 }, duration);
             }
        }

        // ====== SECURITY FUNCTIONS (M√£ h√≥a) ======
        // S·ª≠ d·ª•ng tr√™n trang Generator n√†y ƒë·ªÉ m√£ h√≥a
        function multiLayerEncrypt(content, password, layers = 10) {
            let encrypted = content;
            for (let i = 0; i < layers; i++) {
                // IMPORTANT: Embed the original password and layer index into the payload
                // This allows the decryption side to verify the password at each step
                const combined = `${encrypted}|${password}|${i}`; // Payload|Password|LayerIndex

                // Key derivation for this layer: password + layer index
                const layerKey = password + i;

                // AES encryption
                encrypted = CryptoJS.AES.encrypt(combined, layerKey).toString();

                // Base64 encoding for safe transport/embedding in HTML
                encrypted = btoa(unescape(encodeURIComponent(encrypted))); // Handles UTF-8 correctly
            }
            return encrypted;
        }

        // ====== HTML TEMPLATE GENERATION (ƒê√£ s·ª≠a l·ªói) ======
        function generateTargetHtmlTemplate(markdownContentHtml, pagePassword) {
            // M√£ h√≥a n·ªôi dung HTML ƒë√£ chuy·ªÉn ƒë·ªïi v·ªõi 10 l·ªõp, d√πng m·∫≠t kh·∫©u ng∆∞·ªùi d√πng cung c·∫•p
            const encryptedContent = multiLayerEncrypt(markdownContentHtml, pagePassword, 10);

            // Tho√°t c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát trong m·∫≠t kh·∫©u ƒë·ªÉ nh√∫ng an to√†n v√†o JS trong template
            const escapedPassword = pagePassword.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\$/g, '\\$');

            // Th√¥ng ƒëi·ªáp nh·ªè vui v·∫ª
            const donateMessage = `ü§´ C·∫ßn g·ª£i √Ω m·∫≠t kh·∫©u? ƒê√¥n n·∫øt <strong>10K</strong> v√†o Momo/ZaloPay <strong>0901574726</strong> v√† nh·∫Øn 'Xin g·ª£i √Ω cho file...' nha! üòâ`;

            // --- B·∫ÆT ƒê·∫¶U TEMPLATE STRING CHO FILE HTML ƒê√çCH ---
            // Quan tr·ªçng: S·ª≠ d·ª•ng template literals (`) ƒë·ªÉ d·ªÖ d√†ng vi·∫øt HTML nhi·ªÅu d√≤ng v√† nh√∫ng bi·∫øn.
            return `<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N·ªôi Dung B·∫£o M·∫≠t</title>
    <!-- =========================================================== -->
    <!-- === !! QUAN TR·ªåNG: Nh√∫ng CryptoJS CHO FILE ƒê√çCH !! === -->
    <!-- =========================================================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"><\/script>
    <!-- Link Font Icons (Material Icons) cho file ƒë√≠ch -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* === BASE STYLES (Copy t·ª´ trang g·ªëc, b·∫°n c√≥ th·ªÉ t√πy ch·ªânh ri√™ng) === */
        :root {
            --primary: #00f7ff; --secondary: #6e00ff; --accent: #ff00aa;
            --error: #ff3d71; --success: #00ff88; --warning: #ffcc00;
            --bg-dark: #0a0a20; --bg-darker: #050510; --bg-light: rgba(20, 20, 50, 0.5);
            --bg-lighter: rgba(30, 30, 70, 0.3); --text-light: #e0e0ff;
            --text-lighter: #ffffff; --text-dim: rgba(224, 224, 255, 0.6);
            --border-radius: 12px; --box-shadow: 0 0 30px rgba(0, 247, 255, 0.2);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark); color: var(--text-light);
            min-height: 100vh; overflow-x: hidden; line-height: 1.6; position: relative;
            display: flex; align-items: center; justify-content: center; /* Center content vertically/horizontally */
        }

        /* === BACKGROUND EFFECTS (Copy t·ª´ trang g·ªëc) === */
        .particles-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .particle { position: absolute; background: radial-gradient(circle, var(--primary) 0%, transparent 70%); border-radius: 50%; opacity: 0.6; animation: particle-anim linear infinite; }
        @keyframes particle-anim { 0%{transform:translateY(0) rotate(0deg);opacity:0;} 10%{opacity:0.6;} 100%{transform:translateY(-1500px) rotate(720deg);opacity:0;} }
        .grid-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(110, 0, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(110, 0, 255, 0.05) 1px, transparent 1px); background-size: 40px 40px; z-index: -1; pointer-events: none; }
        .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(0, 247, 255, 0.03), rgba(0, 247, 255, 0.03) 1px, transparent 1px, transparent 3px); z-index: -1; pointer-events: none; animation: scanline 8s linear infinite; }
        @keyframes scanline { 0%{background-position:0 0;} 100%{background-position:0 100%;} }
        .glow-effect { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, rgba(0, 247, 255, 0.05) 0%, transparent 70%); z-index: -1; pointer-events: none; animation: pulse 8s infinite alternate; }
        @keyframes pulse { 0% { opacity: 0.3; transform: scale(0.95); } 100% { opacity: 0.7; transform: scale(1.05); } }

        /* === MAIN CONTAINER (Cho form m·∫≠t kh·∫©u v√† n·ªôi dung) === */
        .container {
            max-width: 800px; width: 90%; /* Make it responsive */
            margin: 2rem auto; padding: 2.5rem;
            background: rgba(10, 10, 32, 0.9); /* Slightly more opaque */
            backdrop-filter: blur(12px); border-radius: var(--border-radius);
            box-shadow: var(--box-shadow); border: 1px solid rgba(110, 0, 255, 0.3);
            position: relative; overflow: hidden; transition: var(--transition);
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } } /* Reduced float */
        .container::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at center, rgba(0, 247, 255, 0.1) 0%, transparent 60%); z-index: -1; animation: pulse 15s infinite alternate; }

        /* === TITLE STYLES === */
        .page-title {
            text-align: center; color: var(--primary); margin-bottom: 2rem; font-weight: 300;
            letter-spacing: 2px; text-transform: uppercase; font-size: 1.6rem; /* Slightly smaller */
            text-shadow: 0 0 15px rgba(0, 247, 255, 0.5); position: relative; padding-bottom: 1rem;
            display: flex; align-items: center; justify-content: center; gap: 0.7rem;
        }
        .page-title .material-icons { font-size: 2rem; }
        .page-title::after { content: ''; position: absolute; bottom: 0; left: 30%; width: 40%; height: 2px; background: linear-gradient(90deg, transparent, var(--primary), transparent); }

        /* === PASSWORD FORM STYLES === */
        .final-page-password-form { display: flex; flex-direction: column; gap: 1.5rem; margin-top: 2rem; max-width: 400px; margin-left: auto; margin-right: auto; }
        .final-page-input-group { position: relative; }
        .final-page-input-group label { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: var(--text-light); font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase; }
        .final-page-input-group label .material-icons { color: var(--secondary); font-size: 1.2rem;}
        .final-page-input-group input[type="password"] {
            width: 100%; padding: 1rem 1.5rem; background: var(--bg-light); border: 1px solid rgba(110, 0, 255, 0.5);
            border-radius: var(--border-radius); color: var(--text-light); font-size: 1.1rem; /* Larger font for password */
            transition: var(--transition); outline: none; letter-spacing: 3px; /* More spacing */
        }
        .final-page-input-group input[type="password"]:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 247, 255, 0.5); transform: translateY(-2px); }
        .final-page-button {
            background: linear-gradient(135deg, var(--secondary), var(--primary)); color: white; border: none; padding: 1rem;
            border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: bold; text-transform: uppercase;
            letter-spacing: 1px; transition: var(--transition); box-shadow: 0 4px 20px rgba(110, 0, 255, 0.4);
            position: relative; overflow: hidden; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .final-page-button .material-icons { font-size: 1.4rem; }
        .final-page-button:hover { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(0, 247, 255, 0.6); }
        .final-page-button::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%); transform: rotate(45deg); animation: shine 3s infinite linear; opacity: 0.5;}
        @keyframes shine { 0%{transform:translateX(-150%) rotate(45deg);} 100%{transform:translateX(150%) rotate(45deg);} }
        .final-page-error-message {
            color: var(--error); text-align: center; margin-top: 0.5rem; font-size: 0.95rem; height: 1.5rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center; gap: 0.4rem; opacity: 0; transition: opacity 0.3s ease;
        }
        .final-page-error-message.show { opacity: 1; }
        .final-page-error-message .material-icons { font-size: 1.2rem; }
        .final-page-input-group input[type="password"].shake { animation: shake-final 0.5s cubic-bezier(.36,.07,.19,.97) both; border-color: var(--error); }
        @keyframes shake-final { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); } 20%, 40%, 60%, 80% { transform: translateX(6px); } }
        .final-page-donation-prompt { text-align: center; margin-top: 1rem; padding: 0.8rem 1rem; background: rgba(255, 204, 0, 0.1); border-left: 4px solid var(--warning); border-radius: var(--border-radius); color: var(--warning); font-size: 0.9rem; line-height: 1.5; font-style: italic; }
        .final-page-donation-prompt strong { font-weight: bold; color: var(--text-lighter); }

        /* === MARKDOWN CONTENT STYLES (ƒê·ªãnh d·∫°ng n·ªôi dung sau khi gi·∫£i m√£) === */
        /* S·ª≠ d·ª•ng ti·ªÅn t·ªë .final-template-styles ƒë·ªÉ tr√°nh xung ƒë·ªôt CSS */
        #final-content-section {
            animation: fadeIn 0.8s ease-out; /* Animation khi n·ªôi dung xu·∫•t hi·ªán */
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .final-template-styles { /* Container cho n·ªôi dung markdown ƒë√£ render */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8; color: var(--text-light); padding: 1rem 0; /* Add padding top/bottom */
            max-width: 100%; /* Fill container width */
        }
        /* Tinh ch·ªânh style cho c√°c th·∫ª HTML sinh ra t·ª´ Markdown */
        .final-template-styles h1, .final-template-styles h2, .final-template-styles h3,
        .final-template-styles h4, .final-template-styles h5, .final-template-styles h6 {
            color: var(--primary); margin-top: 2rem; margin-bottom: 1rem; font-weight: 400; letter-spacing: 1px;
            padding-bottom: 0.5rem; border-bottom: 1px solid rgba(0, 247, 255, 0.2);
        }
        .final-template-styles h1 { font-size: 2rem; color: var(--primary); border-bottom-color: var(--primary); }
        .final-template-styles h2 { font-size: 1.6rem; color: var(--accent); }
        .final-template-styles h3 { font-size: 1.3rem; }
        .final-template-styles p { margin-bottom: 1.5rem; color: var(--text-light); font-size: 1.05rem; }
        .final-template-styles a { color: var(--accent); text-decoration: none; border-bottom: 1px dashed var(--accent); transition: var(--transition); font-weight: 600; }
        .final-template-styles a:hover { color: var(--primary); border-bottom-style: solid; text-decoration: none; }
        .final-template-styles ul, .final-template-styles ol { margin-left: 2rem; margin-bottom: 1.5rem; }
        .final-template-styles li { margin-bottom: 0.6rem; }
        .final-template-styles blockquote { border-left: 4px solid var(--secondary); padding: 1rem 1.5rem; margin: 2rem 0; background: rgba(110, 0, 255, 0.08); border-radius: 0 var(--border-radius) var(--border-radius) 0; font-style: italic; }
        .final-template-styles code { background: var(--bg-lighter); color: var(--accent); padding: 0.3em 0.5em; border-radius: 4px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9em;}
        .final-template-styles pre { background: var(--bg-darker); padding: 1.5rem; border-radius: var(--border-radius); overflow-x: auto; margin-bottom: 1.5rem; border: 1px solid rgba(110, 0, 255, 0.2); }
        .final-template-styles pre code { background: transparent; padding: 0; color: var(--text-light); font-size: 0.95em; line-height: 1.6;}
        .final-template-styles hr { border: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--secondary), transparent); margin: 2.5rem 0; }
        .final-template-styles table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; background: var(--bg-light); overflow: hidden; border-radius: var(--border-radius); border: 1px solid rgba(110, 0, 255, 0.3); }
        .final-template-styles th, .final-template-styles td { border: 1px solid rgba(110, 0, 255, 0.2); padding: 0.8rem 1rem; text-align: left; }
        .final-template-styles th { background: rgba(110, 0, 255, 0.2); color: var(--primary); font-weight: bold; text-transform: uppercase; font-size: 0.9em;}
        .final-template-styles img { max-width: 100%; height: auto; border-radius: 8px; margin: 1rem 0; } /* Style images */


        /* === WARNING MODAL (Cho trang ƒë√≠ch) === */
        .warning-modal { /* Using same class name, it's fine */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(5, 5, 16, 0.9); backdrop-filter: blur(10px); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.5s ease; pointer-events: none;
        }
        .warning-modal:not(.hidden) { opacity: 1; pointer-events: auto; }
        .warning-content {
            background: var(--bg-dark); border: 1px solid var(--error); border-radius: var(--border-radius);
            padding: 2.5rem; max-width: 600px; width: 90%; box-shadow: 0 0 40px rgba(255, 61, 113, 0.3);
            animation: scaleInFinal 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: scale(0.9);
        }
         .warning-modal:not(.hidden) .warning-content { transform: scale(1); }
         @keyframes scaleInFinal { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .warning-title { color: var(--error); text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 0.5rem;}
        .warning-title .material-icons { font-size: 1.8rem; }
        .warning-message { color: var(--text-light); margin-bottom: 2rem; line-height: 1.7; }
        .warning-message p { margin-bottom: 1rem; }
        .warning-message strong { color: var(--warning); }
        .warning-button {
            background: linear-gradient(135deg, var(--error), #ff6b8b); color: white; border: none; padding: 1rem; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: bold; width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 15px rgba(255, 61, 113, 0.4); transition: var(--transition);
        }
         .warning-button .material-icons { font-size: 1.4rem; }
        .warning-button:hover { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(255, 61, 113, 0.6); }

        /* === UTILITY CLASSES === */
        .hidden { display: none !important; /* Force hide */ }
        .text-center { text-align: center; }
        .mt-3 { margin-top: 1.5rem; }
        .footer-note { text-align: center; margin-top: 2rem; font-size: 0.85rem; color: var(--text-dim); opacity: 0.7; }
    </style>
</head>
<body>
    <!-- Background Effects (Cho trang ƒë√≠ch) -->
    <div class="particles-container" id="final-particles"></div>
    <div class="grid-overlay"></div>
    <div class="scanlines"></div>
    <div class="glow-effect"></div>

    <!-- Main Container (Cho trang ƒë√≠ch) -->
    <div class="container">
        <!-- == SECTION 1: Password Input Form == -->
        <div id="final-password-section">
            <h1 class="page-title"><i class="material-icons">lock_outline</i> N·ªôi Dung ƒê∆∞·ª£c B·∫£o M·∫≠t</h1>
            <!-- Form x·ª≠ l√Ω vi·ªác nh·∫≠p m·∫≠t kh·∫©u, g·ªçi h√†m checkFinalPagePassword khi submit -->
            <form class="final-page-password-form" onsubmit="checkFinalPagePassword(event)">
                <div class="final-page-input-group">
                    <label for="final-password-input"><i class="material-icons">password</i> Nh·∫≠p M·∫≠t Kh·∫©u:</label>
                    <input type="password" id="final-password-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required>
                </div>
                <div class="final-page-donation-prompt">
                    ${donateMessage}
                </div>
                <button type="submit" class="final-page-button" id="final-submit-btn">
                    <i class="material-icons">lock_open</i> M·ªü Kh√≥a N·ªôi Dung
                </button>
                <!-- N∆°i hi·ªÉn th·ªã th√¥ng b√°o l·ªói m·∫≠t kh·∫©u -->
                <div class="final-page-error-message" id="final-error-message">
                     <!-- Error messages here -->
                </div>
            </form>
        </div>

        <!-- == SECTION 2: Decrypted Content Area (Hidden initially) == -->
        <div id="final-content-section" class="hidden">
            <!-- N·ªôi dung ƒë√£ gi·∫£i m√£ s·∫Ω ƒë∆∞·ª£c ch√®n v√†o div n√†y -->
            <div class="final-template-styles" id="final-content">
                <!-- Decrypted content will be injected here -->
            </div>
            <div class="footer-note">
                <i class="material-icons" style="font-size: 1rem; vertical-align: text-bottom;">verified_user</i> N·ªôi dung ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi 10 l·ªõp m√£ h√≥a AES.
            </div>
        </div>
    </div>

    <!-- Security Warning Modal (Cho trang ƒë√≠ch) -->
    <div class="warning-modal hidden" id="final-warning-modal">
        <div class="warning-content">
            <h2 class="warning-title"><i class="material-icons">gpp_bad</i> C·∫¢NH B√ÅO AN NINH</h2>
            <div class="warning-message">
                <p>B·∫°n ƒëang truy c·∫≠p v√†o khu v·ª±c n·ªôi dung ƒë∆∞·ª£c m√£ h√≥a b·∫£o m·∫≠t cao (10 l·ªõp AES).</p>
                <p>M·ªçi h√†nh vi c·ªë g·∫Øng gi·∫£i m√£ tr√°i ph√©p, d√≤ m·∫≠t kh·∫©u t·ª± ƒë·ªông, ho·∫∑c ph√¢n ph·ªëi l·∫°i n·ªôi dung m√† kh√¥ng c√≥ s·ª± cho ph√©p ƒë·ªÅu l√† vi ph·∫°m v√† c√≥ th·ªÉ b·ªã theo d√µi.</p>
                <p>H√£y ƒë·∫£m b·∫£o b·∫°n c√≥ quy·ªÅn truy c·∫≠p h·ª£p l·ªá v√† s·ª≠ d·ª•ng m·∫≠t kh·∫©u ƒë∆∞·ª£c cung c·∫•p m·ªôt c√°ch c√≥ tr√°ch nhi·ªám.</p>
                <p><strong>Lu√¥n c·∫£nh gi√°c v√† b·∫£o m·∫≠t th√¥ng tin!</strong></p>
            </div>
            <!-- N√∫t ƒë·ªÉ ƒë√≥ng modal c·∫£nh b√°o -->
            <button class="warning-button" onclick="document.getElementById('final-warning-modal').classList.add('hidden');">
                <i class="material-icons">check_circle_outline</i> T√îI ƒê√É HI·ªÇU V√Ä CAM K·∫æT TU√ÇN TH·ª¶
            </button>
        </div>
    </div>

    <!-- =========================================== -->
    <!-- === JavaScript CHO TRANG ƒê√çCH (quan tr·ªçng) === -->
    <!-- =========================================== -->
    <script>
        // Embedded Encrypted Content (Nh√∫ng d·ªØ li·ªáu ƒë√£ m√£ h√≥a v√†o ƒë√¢y)
        const encryptedContent = \`${encryptedContent}\`;

        // DOM Elements for the final page
        const finalPasswordSection = document.getElementById('final-password-section');
        const finalContentSection = document.getElementById('final-content-section');
        const finalPasswordInput = document.getElementById('final-password-input');
        const finalErrorMessage = document.getElementById('final-error-message');
        const finalContent = document.getElementById('final-content');
        const finalWarningModal = document.getElementById('final-warning-modal');
        const finalParticlesContainer = document.getElementById('final-particles');

        // Function to create particles on the final page
        function createFinalParticles() {
             if (!finalParticlesContainer) return;
             finalParticlesContainer.innerHTML = ''; // Clear existing
             const numParticles = window.innerWidth > 768 ? 150 : 75;
             for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const size = Math.random() * 5 + 1; // Smaller particles
                const posX = Math.random() * window.innerWidth;
                const delay = Math.random() * 12;
                const duration = Math.random() * 18 + 12;
                const opacity = Math.random() * 0.4 + 0.1; // Fainter
                particle.style.width = \`\${size}px\`; particle.style.height = \`\${size}px\`;
                particle.style.left = \`\${posX}px\`; particle.style.bottom = \`-\${size}px\`;
                particle.style.animationDuration = \`\${duration}s\`; particle.style.animationDelay = \`\${delay}s\`;
                particle.style.opacity = opacity;
                const colors = ['#00f7ff', '#6e00ff', '#ff00aa']; // Fewer, themed colors
                const color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.background = \`radial-gradient(circle, \${color} 0%, transparent 70%)\`;
                finalParticlesContainer.appendChild(particle);
             }
        }


        /* ================================================================== */
        /* === Multi-Layer Decryption Function (QUAN TR·ªåNG NH·∫§T ·ªû ƒê√ÇY) === */
        /* ================================================================== */
        function multiLayerDecrypt(encryptedData, password, layers = 10) {
            // !!! ƒê·∫£m b·∫£o r·∫±ng CryptoJS ƒë√£ ƒë∆∞·ª£c n·∫°p (do th·∫ª script ·ªü tr√™n) !!!
            if (typeof CryptoJS === 'undefined') {
                console.error("CryptoJS library is missing! Cannot decrypt.");
                throw new Error("L·ªói th∆∞ vi·ªán m√£ h√≥a. Kh√¥ng th·ªÉ gi·∫£i m√£.");
            }

            let decrypted = encryptedData;
            try {
                // Gi·∫£i m√£ t·ª´ng l·ªõp, t·ª´ l·ªõp ngo√†i c√πng (layers - 1) v√†o trong (0)
                for (let i = layers - 1; i >= 0; i--) {

                    // 1. Base64 Decode: Chuy·ªÉn ƒë·ªïi chu·ªói Base64 v·ªÅ l·∫°i chu·ªói nh·ªã ph√¢n g·ªëc
                    let base64Decoded;
                    try {
                         // S·ª≠ d·ª•ng escape/unescape ƒë·ªÉ x·ª≠ l√Ω c√°c k√Ω t·ª± Unicode c√≥ th·ªÉ c√≥ trong payload g·ªëc tr∆∞·ªõc khi m√£ h√≥a
                        base64Decoded = decodeURIComponent(escape(atob(decrypted)));
                    } catch (e) {
                        console.error(\`Base64 Decode Error at layer \${i}:\`, e);
                        throw new Error(\`L·ªói gi·∫£i m√£ Base64 ·ªü l·ªõp \${i}\`);
                    }

                    // 2. AES Decrypt: Gi·∫£i m√£ AES s·ª≠ d·ª•ng m·∫≠t kh·∫©u + ch·ªâ s·ªë l·ªõp l√†m key
                    let decryptedBytes;
                    const layerKey = password + i; // Key ph·∫£i kh·ªõp v·ªõi key l√∫c m√£ h√≥a
                    try {
                        decryptedBytes = CryptoJS.AES.decrypt(base64Decoded, layerKey);
                    } catch(e) {
                         console.error(\`AES Decryption Error at layer \${i}:\`, e);
                         throw new Error(\`L·ªói gi·∫£i m√£ AES ·ªü l·ªõp \${i}\`);
                    }


                    // 3. Convert to UTF8: Chuy·ªÉn ƒë·ªïi k·∫øt qu·∫£ gi·∫£i m√£ v·ªÅ chu·ªói UTF-8
                    let utf8Decoded;
                    try {
                        utf8Decoded = decryptedBytes.toString(CryptoJS.enc.Utf8);
                    } catch (e) {
                        console.error(\`UTF8 Conversion Error at layer \${i}:\`, e);
                         // L·ªói n√†y th∆∞·ªùng x·∫£y ra n·∫øu key sai ho·∫∑c d·ªØ li·ªáu b·ªã h·ªèng, d·∫´n ƒë·∫øn gi·∫£i m√£ ra byte kh√¥ng h·ª£p l·ªá
                         throw new Error(\`D·ªØ li·ªáu gi·∫£i m√£ kh√¥ng h·ª£p l·ªá ·ªü l·ªõp \${i} (C√≥ th·ªÉ sai m·∫≠t kh·∫©u ho·∫∑c d·ªØ li·ªáu l·ªói)\`);
                    }

                    // !!! KI·ªÇM TRA QUAN TR·ªåNG !!!
                    // N·∫øu toString(CryptoJS.enc.Utf8) tr·∫£ v·ªÅ chu·ªói r·ªóng, ƒëi·ªÅu ƒë√≥ *g·∫ßn nh∆∞ ch·∫Øc ch·∫Øn* nghƒ©a l√† M·∫¨T KH·∫®U SAI ·ªü l·ªõp n√†y
                    if (!utf8Decoded) {
                         console.warn(\`Decryption resulted in empty string at layer \${i}. Likely wrong password or corrupt data.\`);
                        throw new Error(\`Gi·∫£i m√£ th·∫•t b·∫°i ·ªü l·ªõp \${i} - M·∫≠t kh·∫©u kh√¥ng kh·ªõp?\`);
                    }

                    // 4. Split and Validate Payload: T√°ch chu·ªói ƒë√£ gi·∫£i m√£ (N·ªôiDung|PasswordG·ªëc|LayerIndex)
                    const parts = utf8Decoded.split("|");

                    // X√°c th·ª±c:
                    // a) Ph·∫£i c√≥ ƒë·ªß 3 ph·∫ßn t·ª≠ sau khi t√°ch.
                    // b) Ph·∫ßn t·ª≠ th·ª© 2 (parts[1]) ph·∫£i ch√≠nh x√°c l√† m·∫≠t kh·∫©u m√† ng∆∞·ªùi d√πng ƒë√£ nh·∫≠p (password).
                    // c) Ph·∫ßn t·ª≠ th·ª© 3 (parts[2]) ph·∫£i ch√≠nh x√°c l√† ch·ªâ s·ªë l·ªõp hi·ªán t·∫°i (i). (T√πy ch·ªçn, nh∆∞ng tƒÉng c∆∞·ªùng b·∫£o m·∫≠t)
                    if (parts.length < 3 || parts[1] !== password /*|| parseInt(parts[2]) !== i*/) {
                         console.error(\`Payload validation failed at layer \${i}. Expected password "\${password}" | Found "\${parts[1]}". Expected layer \${i} | Found \${parts[2]}. Parts: \`, parts);
                         throw new Error(\`X√°c th·ª±c d·ªØ li·ªáu th·∫•t b·∫°i ·ªü l·ªõp \${i}. M·∫≠t kh·∫©u c√≥ th·ªÉ kh√¥ng ƒë√∫ng.\`);
                    }

                    // 5. Extract Content: N·∫øu m·ªçi th·ª© OK, l·∫•y ph·∫ßn n·ªôi dung th·ª±c s·ª± (parts[0]) ƒë·ªÉ gi·∫£i m√£ l·ªõp ti·∫øp theo
                    decrypted = parts[0];
                }
                // Sau khi v√≤ng l·∫∑p k·∫øt th√∫c th√†nh c√¥ng, 'decrypted' ch√≠nh l√† n·ªôi dung HTML g·ªëc
                return decrypted;
            } catch (e) {
                // B·∫Øt b·∫•t k·ª≥ l·ªói n√†o x·∫£y ra trong v√≤ng l·∫∑p
                console.error("Decryption process failed:", e);
                // Kh√¥ng tr·∫£ v·ªÅ n·ªôi dung l·ªói, ch·ªâ tr·∫£ v·ªÅ null ƒë·ªÉ bi·∫øt th·∫•t b·∫°i
                return null;
            }
        }

        // Password Check Function (Called on form submit)
        function checkFinalPagePassword(event) {
            event.preventDefault(); // NgƒÉn ch·∫∑n form submit v√† t·∫£i l·∫°i trang

            const enteredPassword = finalPasswordInput.value;
            finalErrorMessage.textContent = ''; // X√≥a l·ªói c≈©
            finalErrorMessage.classList.remove('show'); // ·∫®n th√¥ng b√°o l·ªói c≈©
            finalPasswordInput.classList.remove('shake'); // X√≥a hi·ªáu ·ª©ng l·∫Øc c≈©

            if (!enteredPassword) {
                finalErrorMessage.innerHTML = '<i class="material-icons">error_outline</i> Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u';
                finalErrorMessage.classList.add('show');
                finalPasswordInput.focus();
                finalPasswordInput.classList.add('shake');
                return;
            }

            // V√¥ hi·ªáu h√≥a n√∫t submit trong khi x·ª≠ l√Ω
            const submitButton = document.getElementById('final-submit-btn');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="material-icons spin">hourglass_top</i> ƒêang gi·∫£i m√£...';


            // S·ª≠ d·ª•ng setTimeout ƒë·ªÉ gi·∫£i m√£ kh√¥ng ch·∫∑n giao di·ªán ng∆∞·ªùi d√πng ngay l·∫≠p t·ª©c
            setTimeout(() => {
                 try {
                     // ---> G·ªçi h√†m gi·∫£i m√£ ƒëa l·ªõp <---
                     const decryptedHtml = multiLayerDecrypt(encryptedContent, enteredPassword, 10); // S·ª≠ d·ª•ng 10 l·ªõp

                     if (decryptedHtml !== null) {
                         // --- TH√ÄNH C√îNG ---
                         finalContent.innerHTML = decryptedHtml; // Ch√®n HTML ƒë√£ gi·∫£i m√£
                         finalPasswordSection.style.display = 'none'; // ·∫®n form m·∫≠t kh·∫©u
                         finalContentSection.classList.remove('hidden'); // Hi·ªán khu v·ª±c n·ªôi dung
                         console.log('Decryption Successful:', new Date().toLocaleString());
                         // C√≥ th·ªÉ th√™m hi·ªáu ·ª©ng v√†o cho ƒë·∫πp
                         finalContentSection.style.opacity = '0';
                         requestAnimationFrame(() => { finalContentSection.style.opacity = '1'; });

                     } else {
                         // --- TH·∫§T B·∫†I (multiLayerDecrypt tr·∫£ v·ªÅ null) ---
                         throw new Error("M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c ho·∫∑c d·ªØ li·ªáu b·ªã l·ªói."); // N√©m l·ªói ƒë·ªÉ kh·ªëi catch x·ª≠ l√Ω
                     }

                 } catch (e) {
                     // --- X·ª¨ L√ù L·ªñI (T·ª´ multiLayerDecrypt ho·∫∑c t·ª´ kh·ªëi try ·ªü tr√™n) ---
                     console.error('Decryption failed:', e.message);
                     finalErrorMessage.innerHTML = \`<i class="material-icons">warning</i> \${e.message || 'M·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c!'}\`;
                     finalErrorMessage.classList.add('show');
                     finalPasswordInput.value = ''; // X√≥a m·∫≠t kh·∫©u ƒë√£ nh·∫≠p sai
                     finalPasswordInput.focus();
                     finalPasswordInput.classList.add('shake'); // L·∫Øc nh·∫π b√°o l·ªói

                 } finally {
                      // D√π th√†nh c√¥ng hay th·∫•t b·∫°i, b·∫≠t l·∫°i n√∫t submit
                      submitButton.disabled = false;
                      submitButton.innerHTML = '<i class="material-icons">lock_open</i> M·ªü Kh√≥a N·ªôi Dung';
                 }
            }, 50); // Delay nh·ªè ƒë·ªÉ UI k·ªãp c·∫≠p nh·∫≠t tr·∫°ng th√°i "ƒêang gi·∫£i m√£"

        }

        // Initial setup when the final page loads
        document.addEventListener('DOMContentLoaded', function() {
            createFinalParticles(); // T·∫°o hi·ªáu ·ª©ng h·∫°t
            finalWarningModal.classList.remove('hidden'); // Hi·ªán c·∫£nh b√°o b·∫£o m·∫≠t ban ƒë·∫ßu
            finalPasswordInput.focus(); // Focus v√†o √¥ nh·∫≠p m·∫≠t kh·∫©u

             // Th√™m hi·ªáu ·ª©ng quay cho icon loading tr√™n n√∫t submit
             const style = document.createElement('style');
             style.innerHTML = \`
                 @keyframes spin {
                     from { transform: rotate(0deg); }
                     to { transform: rotate(360deg); }
                 }
                 .spin { animation: spin 1s linear infinite; }
             \`;
             document.head.appendChild(style);
        });

        // Handle window resize for particles on final page
        let finalResizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(finalResizeTimeout);
            finalResizeTimeout = setTimeout(createFinalParticles, 250); // Debounce
        });
    <\/script>
</body>
</html>`;
        // --- K·∫æT TH√öC TEMPLATE STRING CHO FILE HTML ƒê√çCH ---
        }


        // ====== GENERATOR PAGE FUNCTIONS (Logic cho trang t·∫°o m√£) ======
        function handleGenerate() {
            const markdownText = markdownInput.value;
            const outputPassword = outputPasswordInput.value;

            outputPasswordInput.classList.remove('error'); // X√≥a l·ªói c≈© ·ªü √¥ password

            // === Validation ===
            if (!markdownText.trim()) {
                showStatus("Vui l√≤ng nh·∫≠p n·ªôi dung Markdown.", "error", "edit_note");
                markdownInput.focus();
                return;
            }
            if (!outputPassword) { // Check c·∫£ chu·ªói r·ªóng
                 showStatus("B·∫°n ch∆∞a ƒë·∫∑t m·∫≠t kh·∫©u b·∫£o m·∫≠t!", "error", "key_off");
                outputPasswordInput.classList.add('error');
                outputPasswordInput.focus();
                return;
            }
             if (outputPassword.length < 8) { // Y√™u c·∫ßu ƒë·ªô d√†i t·ªëi thi·ªÉu
                 showStatus("M·∫≠t kh·∫©u qu√° ng·∫Øn (c·∫ßn √≠t nh·∫•t 8 k√Ω t·ª±)!", "error", "password");
                outputPasswordInput.classList.add('error');
                outputPasswordInput.focus();
                 return;
            }
            // C√≥ th·ªÉ th√™m ki·ªÉm tra ƒë·ªô ph·ª©c t·∫°p m·∫≠t kh·∫©u ·ªü ƒë√¢y (ch·ªØ hoa, th∆∞·ªùng, s·ªë, k√Ω t·ª± ƒë·∫∑c bi·ªát)

            // === Markdown Conversion ===
            try {
                 marked.setOptions({
                     breaks: true,    // Convert newlines to <br>
                     gfm: true,       // Enable GitHub Flavored Markdown
                     mangle: false,   // T·∫Øt m√£ h√≥a email ƒë·ªÉ tr√°nh l·ªói kh√¥ng mong mu·ªën
                     headerIds: false // T·∫Øt t·∫°o ID t·ª± ƒë·ªông cho header n·∫øu kh√¥ng c·∫ßn
                 });
                 const convertedHtml = marked.parse(markdownText);

                // === Show Security Warning Modal Before Generation ===
                warningModal.classList.remove('hidden'); // Hi·ªán modal

                // === Handle Confirmation ===
                // S·ª≠ d·ª•ng .onclick ƒë·ªÉ d·ªÖ d√†ng g·ª° b·ªè listener c≈© n·∫øu c√≥
                warningConfirm.onclick = function() {
                     warningModal.classList.add('hidden'); // ·∫®n modal

                     // ---> Generate the Final HTML <---
                     try {
                          fullHtmlToCopy = generateTargetHtmlTemplate(convertedHtml, outputPassword);
                          showStatus("T·∫°o m√£ ngu·ªìn th√†nh c√¥ng! S·∫µn s√†ng ƒë·ªÉ sao ch√©p.", "success", "check_circle");
                          copyButton.disabled = false; // B·∫≠t n√∫t sao ch√©p
                          copyButton.classList.remove('copied'); // Reset tr·∫°ng th√°i n√∫t copy
                          copyButton.innerHTML = '<i class="material-icons">content_copy</i> Sao Ch√©p M√£ Ngu·ªìn';
                          console.log("HTML generated successfully.");
                     } catch (genError) {
                         console.error("Error during HTML template generation:", genError);
                         showStatus("L·ªói khi t·∫°o template HTML. Ki·ªÉm tra Console.", "error", "error");
                         fullHtmlToCopy = '';
                         copyButton.disabled = true;
                     }
                };

            } catch (markdownError) {
                console.error("L·ªói chuy·ªÉn ƒë·ªïi Markdown:", markdownError);
                showStatus("L·ªói c√∫ ph√°p Markdown. Ki·ªÉm tra l·∫°i n·ªôi dung.", "error", "error");
                fullHtmlToCopy = '';
                copyButton.disabled = true;
            }
        }

        function handleCopy() {
            if (!fullHtmlToCopy) {
                 showStatus("Ch∆∞a c√≥ g√¨ ƒë·ªÉ sao ch√©p. H√£y t·∫°o m√£ ngu·ªìn tr∆∞·ªõc.", "info", "info");
                return;
            }

            navigator.clipboard.writeText(fullHtmlToCopy)
                .then(() => {
                    showStatus("ƒê√£ sao ch√©p m√£ ngu·ªìn v√†o clipboard!", "success", "done_all", 2500); // T·ª± ·∫©n sau 2.5s
                    copyButton.classList.add('copied');
                    copyButton.innerHTML = '<i class="material-icons">check_circle</i> ƒê√£ Sao Ch√©p!';

                    // Kh√¥ng c·∫ßn setTimeout ƒë·ªÉ reset n√∫t ·ªü ƒë√¢y, showStatus ƒë√£ x·ª≠ l√Ω ·∫©n th√¥ng b√°o
                    // Reset n√∫t copy sau 1 th·ªùi gian ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt ƒë√£ copy
                    setTimeout(() => {
                        if (copyButton.classList.contains('copied')) { // Ch·ªâ reset n·∫øu v·∫´n ƒëang ·ªü tr·∫°ng th√°i copied
                            copyButton.classList.remove('copied');
                            copyButton.innerHTML = '<i class="material-icons">content_copy</i> Sao Ch√©p M√£ Ngu·ªìn';
                        }
                    }, 2500);
                })
                .catch(err => {
                    console.error('L·ªói sao ch√©p v√†o clipboard: ', err);
                    showStatus("L·ªói sao ch√©p! Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ho·∫∑c c·∫ßn c·∫•p quy·ªÅn.", "error", "report_problem");
                    // C√≥ th·ªÉ hi·ªán n·ªôi dung trong textarea ƒë·ªÉ ng∆∞·ªùi d√πng copy th·ªß c√¥ng
                });
        }

        // ====== INITIALIZATION (Ch·∫°y khi trang Generator t·∫£i xong) ======
        document.addEventListener('DOMContentLoaded', function() {
            createParticles(particlesContainer); // T·∫°o hi·ªáu ·ª©ng cho trang generator

            // Event listeners
            generateButton.addEventListener('click', handleGenerate);
            copyButton.addEventListener('click', handleCopy);

            // X√≥a l·ªói khi ng∆∞·ªùi d√πng nh·∫≠p l·∫°i m·∫≠t kh·∫©u
            outputPasswordInput.addEventListener('input', () => {
                if (outputPasswordInput.value) {
                    outputPasswordInput.classList.remove('error');
                }
            });

            // ƒê·∫∑t listener ƒë·ªÉ ƒë√≥ng modal c·∫£nh b√°o n·∫øu click ra ngo√†i (overlay)
            warningModal.addEventListener('click', function(event) {
                if (event.target === warningModal) { // Ch·ªâ ƒë√≥ng khi click v√†o n·ªÅn m·ªù
                    warningModal.classList.add('hidden');
                    if(warningConfirm.onclick) { // H·ªßy b·ªè h√†nh ƒë·ªông confirm n·∫øu ng∆∞·ªùi d√πng ƒë√≥ng modal
                        warningConfirm.onclick = null;
                    }
                }
            });

            // Initial status message
            showStatus("üöÄ S·∫µn s√†ng m√£ h√≥a Markdown th√†nh HTML si√™u b·∫£o m·∫≠t!", "info", "rocket_launch", 7000);

            // Handle window resize for generator page particles
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => createParticles(particlesContainer), 250); // Debounce resize
            });
        });
    </script>
</body>
</html>
